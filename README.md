# Deployment Template
This collection of templates is used to deploy services on AWS ECS.

# Process

## 1- Deploy Cluster
Deploy two ECS clusters using the CFN template generated by *1_ecs-cluster-cf-template.py*.
When creating the clusters, provide names in the format **staging-cluster** and **production-cluster**.

## 2- Deploy ALBs
Place the contents of the /ELBPipeline path into a CodeCommit repository, then deploy a template generated by *2_alb-route53-pipeline-cf-template.py* pointing to that repository, and listing.

To add records to Route53 to route to new services, simply add them to the *services.yaml* file in CodeCommit.

## 3- Provision App Repository
Provision a CodeCommit repo with the name of the app. In the folder, place the *ecs-service-cf.template* template in the ./templates directory and a Dockerfile in the root.

## 4- Service Template
Deploy the *deploy-service-cf.template*. This will launch a CodePipeline to orchestrate CodeBuild and deployment via nested CloudFormations.

It is recommended to name the stack with format **appname-codepipeline**, and list the name of your CodeCommit repo as the input parameter.



# Plan/ To Do:

- [x] Implement path-based routing pipe with simple appname by linking Services to ALB Paths
- [x] Update ALB template for host-based routing connected to Route53
- [x] Shorten prod/staging names
- [x] Clean up ELB/Domain work
- [x] Lock down security group on Route53/ALB
- [x] CodePipeline for all infrastructure
- [x] Scaling rules for containers (https://github.com/cloudtools/troposphere/blob/master/examples/ApplicationAutoScalingSample.py)
- [x] Cloudwatch logging
- [x] Test autoscaling
- [x] Test rolling Update
- [x] Test instance upgrade

- [ ] Move resources into private subnets of VPC
- [ ] Get CloudWatch dashboards coded
- [ ] Lock down IAM permissions
- [ ] Template for scheduled tasks
